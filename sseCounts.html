<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SSE consumption of changelog stream</title>
    <script lang="javascript">
        
        function EmojiCounts() {

            this.source = null;

            this.start = function () {

                var ecTable = document.getElementById("emoji-counts");

                this.source = new EventSource("http://localhost:8881/interactive/queries/emojis/updates/notify");
                this.source.addEventListener("message", function (event) {

                    var ec = JSON.parse(event.data);

                    var row = ecTable.getElementsByTagName("tbody")[0].insertRow(0);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);

                    cell1.className = "emoji";
                    cell1.innerHTML = ec.emoji;

                    cell2.className = "count";
                    cell2.innerHTML = ec.count;

                });

                this.source.onerror = function () {
                    this.close();
                };

            };

            this.stop = function () {
                this.source.close();
            }

        }

        EmojiCounts = new EmojiCounts();

        window.onload = function () {
            EmojiCounts.start();
        };
        window.onbeforeunload = function () {
            EmojiCounts.stop();
        }
    </script>
</head>

<body>
    <table id="emoji-counts">
        <thead>
            <tr>
                <th colspan="2">Emoji Counts Changelog:</th>
            </tr>
        </thead>
        <tbody>
            <!--<tr>
                <td class="emoji">n.a.</td>
                <td class="count">n.a.</td>
            </tr>-->
        </tbody>
    </table>
</body>
</html>
